{% extends 'base.html' %}
{% load static %}

{% block header %}
    {% include 'headers/topbar.html' with article=article section=article.section.slug %}
    {% include 'headers/mobile.html' %}
{% endblock %}

{% block content %}
<script src="https://code.jquery.com/jquery-2.1.4.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="https://s3-us-west-1.amazonaws.com/ubyssey/static/css/jquery.datetimepicker.min.css" />
<script type="text/javascript" src="https://s3-us-west-1.amazonaws.com/ubyssey/static/js/jquery.datetimepicker.full.min.js"></script>

<main>
  <div class="u-container u-container--padded">
    {% include 'events/submit/header.html' %}

    {% if facebook_error %}
    <div class="c-fb-err-message">
      Sorry, we weren't able to import an event from the Facebook URL you provided. Please try again or use the form below.
    </div>

    <form method="post" class="c-input-fb c-input-fb--borders" action="{% url 'events-submit-form' %}?facebook=1">
      {% csrf_token %}
      <div class="c-input c-input-fb">
        {{ form.facebook_url.errors }}
        <input class="c-input c-input-fb c-input--text" placeholder="Event URL" id="facebook_url" type="text" name="facebook_url" />
        <input type="hidden" name="facebook_import" value="1" />
        <input class="c-input c-input--button--left c-input--button" type="submit" value="Import" />
      </div>
    </form>
    {% endif %}

    {{ form.non_field_errors }}
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="c-form-input c-form-input--text">
        <label class="c-form-input--text" for="{{ form.title.id_for_label }}">Title of Event<br></label>
        {{ form.title }}
        {{ form.title.errors }}
      </div>

      <div class="c-form-input c-form-input--text">
        <label for="{{ form.description.id_for_label }}">Description<br></label>
        {{ form.description }}
        {{ form.description.errors }}
      </div>

      <div class="c-two-col">
        <div class="c-form-input c-form-input--text c-two-col--left">
          <label for="{{ form.host.id_for_label }}">Host<br></label>
          {{ form.host }}
          {{ form.description.errors }}
        </div>

        <div class="c-form-input c-form-input--text c-two-col--right">
          <label for="{{ form.category.id_for_label }}">Category of Event<br></label>
          {{ form.category }}
          {{ form.category.errors }}
        </div>
      </div>

      <div class="c-two-col">
        <div class="c-form-input c-form-input--text c-two-col--left">
          <label class="starttime" for="{{ form.start_time.id_for_label }}">Start Time<br></label>
          {{ form.start_time }}
          {{ form.start_time.errors }}
        </div>

        <div class="c-form-input c-form-input--text c-two-col--right">
          {{ form.end_time.errors }}
          <label for="{{ form.end_time.id_for_label }}">End Time<br></label>
          {{ form.end_time }}
        </div>
      </div>

      {% if form.facebook_image_url.value %}
      <div class="c-form-input c-form-input--image">

        {{ form.facebook_image_url.errors }}

        <label for="{{ form.facebook_image_url.id_for_label }}">Image for the Event<br></label>

        <img id="previewImage" src="{{ form.facebook_image_url.value }}" >

        {{ form.image.errors }}
        <label for="{{ form.image.id_for_label }}"><br>Or choose your own image<br></label>
        <input id="imgInp" type="file" onchange="readUrl(this);" name="image"/>

        <input id="reset" type="reset"
        value="Or stick with the facebook image" onclick="
          document.getElementById('previewImage').src='{{ form.facebook_image_url.value }}';
          document.getElementById('reset').style.display = 'none';" />

      </div>

      {% else %}
      <div class="c-form-input c-form-input--image">
        {{ form.image.errors }}
        <label for="{{ form.image.id_for_label }}">Image for the Event<br></label>
        <input id="imgInp" type="file" onchange="readUrl(this);" name="image"/>
        <img id="previewImage"/>
      </div>
      {% endif %}

      <div class="c-form-input c-form-input--text">
        <label for="{{ form.location.id_for_label }}">Location<br></label>
        {{ form.location }}
        {{ form.location.errors }}
      </div>

      <div class="c-form-input c-form-input--text">
        <label for="{{ form.address.id_for_label }}">Address<br></label>
        {{ form.address }}
        {{ form.address.errors }}
      </div>

      <div class="c-form-input c-form-input--text">
        <i>Please add in your email and phone number! It will allow us to contact you in case we need to confirm any information.</i>
      </div>

      <div class="c-form-input c-form-input--email">
        <label for="{{ form.submitter_email.id_for_label }}">Email <br></label>
        {{ form.submitter_email }}
        {{ form.submitter_email.errors }}
      </div>

      <div class="c-form-input c-form-input--tel">
        <label for="{{ form.submitter_phone.id_for_label }}">Phone Number <br></label>
        {{ form.submitter_phone }}
        {{ form.submitter_phone.errors }}
      </div>

      <p hidden>{{ form.facebook_url }}</p>
      <p hidden>{{ form.facebook_image_url }}</p>

      <div class="c-input">
        <input method="post" class="c-input c-input--button--saved" type="submit" name="submit_event" value="Submit Event" />
      </div>

    </form>
  </div>
</main>

<script type="text/javascript">

  jQuery('#id_start_time').datetimepicker({
    minDate:new Date(),
    format:'Y-m-d H:i',
    formatTime:'H:i',
    formatDate:'Y-m-d'
  });

  jQuery('#id_end_time').datetimepicker({
    minDate:new Date(),
    format:'Y-m-d H:i',
    formatTime:'H:i',
    formatDate:'Y-m-d'
  });

</script>

<script type="text/javascript">

  function readURL(input) {
    if (input.files && input.files[0]) {

      var reader = new FileReader();
      reader.onload = function(e) {
        $('#previewImage').attr('src', e.target.result);
      }
      // TODO: Hidden vs unhidden for the image
      // If (not facebook image or image) display else dont

      reader.readAsDataURL(input.files[0]);
    }

    var x = document.getElementById('reset');
    x.style.display = 'inline';
  }

  $("#imgInp").change(function() {
    readURL(this);
  });

  function hideReset() {
    {document.getElementById("reset") ? document.getElementById("reset").style.display = 'none': null};
  }

  window.onload = hideReset

</script>
{% endblock %}
