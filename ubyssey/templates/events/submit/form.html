{% extends 'base.html' %}
{% load static %}

{% block header %}
    {% include 'headers/topbar.html' with article=article section=article.section.slug %}
    {% include 'headers/mobile.html' %}
{% endblock %}

{% block content %}
<script src="https://code.jquery.com/jquery-2.1.4.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="https://s3-us-west-1.amazonaws.com/ubyssey/static/css/jquery.datetimepicker.min.css" />
<script type="text/javascript" src="https://s3-us-west-1.amazonaws.com/ubyssey/static/js/jquery.datetimepicker.full.min.js"></script>

<main>
  <div class="u-container u-container--padded">
    {% include 'events/submit/header.html' %}

    {% if facebook_error %}
    <div class="c-fb-err-message">
      Sorry, we weren't able to import an event from the Facebook URL you provided. Please try again or use the form below.
    </div>

    <form method="post" class="c-input-fb c-input-fb--borders" action="{% url 'events-submit-form' %}?facebook=1">
      {% csrf_token %}
      <input type="hidden" name="facebook_import" value="1" />
      <div class="c-input-fb__field c-input-group">
        <input class="c-text-input" type="text" name="facebook_url" placeholder="Event URL" />
        <input class="c-button" type="submit" value="Import" />
      </div>
    </form>
    {% endif %}

    {{ form.non_field_errors }}
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="c-form-input">
        {{ form.title.errors }}
        <label for="{{ form.title.id_for_label }}">Title of Event</label>
        {{ form.title }}
      </div>

      <div class="c-form-input">
        {{ form.description.errors }}
        <label for="{{ form.description.id_for_label }}">Description</label>
        {{ form.description }}
      </div>

      <div class="c-two-col">
        <div class="c-form-input" type="left">
          {{ form.host.errors }}
          <label for="{{ form.host.id_for_label }}">Host</label>
          {{ form.host }}
        </div>

        <div class="c-form-input" type="right">
          {{ form.category.errors }}
          <label for="{{ form.category.id_for_label }}">Category of Event</label>
          {{ form.category }}
        </div>
      </div>

      <div class="c-two-col">
        <div class="c-form-input" type="left">
          {{ form.start_time.errors }}
          <label class="starttime" for="{{ form.start_time.id_for_label }}">Start Time</label>
          {{ form.start_time }}
        </div>

        <div class="c-form-input" type="right">
          {{ form.end_time.errors }}
          <label for="{{ form.end_time.id_for_label }}">End Time</label>
          {{ form.end_time }}
        </div>
      </div>

      {% if form.facebook_image_url.value %}
      <div class="c-form-input">

        {{ form.facebook_image_url.errors }}

        <label for="{{ form.facebook_image_url.id_for_label }}">Image for the Event</label>

        <img id="previewImage" src="{{ form.facebook_image_url.value }}" >

        {{ form.image.errors }}
        <label for="{{ form.image.id_for_label }}">Or choose your own image</label>
        <input id="imgInp" type="file" onchange="readUrl(this);" name="image"/>

        <input id="reset" type="reset"
        value="Or stick with the facebook image" onclick="
          document.getElementById('previewImage').src='{{ form.facebook_image_url.value }}';
          document.getElementById('reset').style.display = 'none';" />

      </div>

      {% else %}
      <div class="c-form-input">
        {{ form.image.errors }}
        <label for="{{ form.image.id_for_label }}">Image for the Event</label>
        <input id="imgInp" type="file" onchange="readUrl(this);" name="image"/>
        <img id="previewImage"/>
      </div>
      {% endif %}

      <div class="c-form-input">
        {{ form.location.errors }}
        <label for="{{ form.location.id_for_label }}">Location</label>
        {{ form.location }}
      </div>

      <div class="c-form-input">
        {{ form.address.errors }}
        <label for="{{ form.address.id_for_label }}">Address</label>
        {{ form.address }}
      </div>

      <h3 class="c-heading c-heading--3">Contact Information</h3>

      <div class="c-form-input c-form-input--email">
        {{ form.submitter_email.errors }}
        <label for="{{ form.submitter_email.id_for_label }}">Email </label>
        {{ form.submitter_email }}
      </div>

      <div class="c-form-input c-form-input--phone">
        {{ form.submitter_phone.errors }}
        <label for="{{ form.submitter_phone.id_for_label }}">Phone Number </label>
        {{ form.submitter_phone }}
      </div>

      <p hidden>{{ form.facebook_url }}</p>
      <p hidden>{{ form.facebook_image_url }}</p>

      <div class="c-input">
        <input method="post" class="c-input c-input--button" type="submit" name="submit_event" value="Submit Event" />
      </div>

    </form>
  </div>
</main>

<script type="text/javascript">

  jQuery('#id_start_time').datetimepicker({
    minDate:new Date(),
    format:'Y-m-d H:i',
    formatTime:'H:i',
    formatDate:'Y-m-d'
  });

  jQuery('#id_end_time').datetimepicker({
    minDate:new Date(),
    format:'Y-m-d H:i',
    formatTime:'H:i',
    formatDate:'Y-m-d'
  });

</script>

<script type="text/javascript">

  function readURL(input) {
    if (input.files && input.files[0]) {

      var reader = new FileReader();
      reader.onload = function(e) {
        $('#previewImage').attr('src', e.target.result);
      }
      // TODO: Hidden vs unhidden for the image
      // If (not facebook image or image) display else dont

      reader.readAsDataURL(input.files[0]);
    }

    var x = document.getElementById('reset');
    x.style.display = 'inline';
  }

  $("#imgInp").change(function() {
    readURL(this);
  });

  function hideReset() {
    {document.getElementById("reset") ? document.getElementById("reset").style.display = 'none': null};
  }

  window.onload = hideReset

</script>
{% endblock %}
